services:
  # WireGuard Service
  - type: pserv
    name: wireguard-vpn
    runtime: image
    image:
      url: lscr.io/linuxserver/wireguard:latest
    plan: free
    envVars:
      - key: PUID
        value: 1000
      - key: PGID
        value: 1000
      - key: TZ
        value: Asia/Kolkata
      - key: SERVERURL
        value: auto
      - key: SERVERPORT
        value: 51820
      - key: PEERS
        value: phone,laptop
      - key: PEERDNS
        value: auto
      - key: INTERNAL_SUBNET
        value: 10.13.13.0
      - key: ALLOWEDIPS
        value: 0.0.0.0/0
      - key: LOG_CONFS
        value: "true"
    disk:
      name: wireguard-config
      mountPath: /config
      sizeGB: 1
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
      - net.ipv4.ip_forward=1

  # ngrok Service
  - type: pserv
    name: ngrok-tunnel
    runtime: image
    image:
      url: ngrok/ngrok:latest
    plan: free
    envVars:
      - key: NGROK_AUTHTOKEN
        sync: false
    command: udp 51820

  # Web UI Service
  - type: web
    name: wireguard-webui
    runtime: image
    image:
      url: nginx:alpine
    plan: free
    envVars:
      - key: NGROK_AUTH_TOKEN
        sync: false
    disk:
      name: wireguard-config
      mountPath: /usr/share/nginx/html/config
      readOnly: true